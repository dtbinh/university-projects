#include <stddef.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "include/types.h"
#include "include/scanner.h"
#include "include/symboltable.h"
#include "include/parser.h"
#include "include/opcodes.h"
#include "include/codegen.h"

int main (int argc,char** argv) {
	int status;
	FILE* fptr;
	
	if (( argc < 2 ) || (argc > 3))
	{
        	printf( "Usage: cpl [-d ]<filename>\n" );
	        printf( "\t<filename> file to be compiled\n");
		printf("\t-d : optional parameter for debug output file\n");
    	}else
	{
		if (argc == 3)
		{
			if (strcmp(argv[1],"-d") != 0)
			{
				printf("Invalid parameter %s\n",argv[1]);
				exit(1);
			}else
			{
				printf("Switch on debug output\n");
			}
			
			
		}
		fptr = init(argv[argc-1]);
		init_table();
		initCodeGen(0);
		printf("Compiling...\n");
		status = parse();
		if (status){
			printf("\nCompiled %s with no errors\n",argv[argc-1]);
		}else{
			printf("\nThere were errors\n");
		}
		dumpToFile();
		fclose(fptr);
		clear_list();
		
		int a[40];
		a[1]=2;
  		a[2]=1;
  a[3] = 4;
  a[4] = a[2]/4+1*(12-8)+a[2]/a[2]-1;
  printf(" aaa %d\n",a[4]);
  int x= a[a[4]-a[3]+a[2]];
  printf("x = %d\n",x);
		
	}
	return 1;
}


